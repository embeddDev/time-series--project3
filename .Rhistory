{
usr <- par("usr"); on.exit(par(usr))
par(usr = c(0, 1, 0, 1))
r = (cor(x, y,use="pairwise"))
txt <- format(c(r, 0.123456789), digits=digits)[1]
txt <- paste(prefix, txt, sep="")
if(missing(cex.cor)) cex <- 0.8/strwidth(txt)
text(0.5, 0.5, txt, cex = cex )
}
panel.hist <- function(x, ...)
{
usr <- par("usr"); on.exit(par(usr))
par(usr = c(usr[1:2], 0, 1.5) )
h <- hist(x, plot = FALSE)
breaks <- h$breaks; nB <- length(breaks)
y <- h$counts; y <- y/max(y)
rect(breaks[-nB], 0, breaks[-1], y, col="cyan", ...)
}
pairs.panels <- function (x,y,smooth=TRUE,scale=FALSE)
{if (smooth ){
if (scale) {
pairs(x,diag.panel=panel.hist,upper.panel=panel.cor.scale,lower.panel=panel.smooth)
}
else {pairs(x,diag.panel=panel.hist,upper.panel=panel.cor,lower.panel=panel.smooth)
} #else {pairs(x,diag.panel=panel.hist,upper.panel=panel.cor,lower.panel=panel.smooth)
}
else #smooth is not true
{ if (scale) {pairs(x,diag.panel=panel.hist,upper.panel=panel.cor.scale)
} else {pairs(x,diag.panel=panel.hist,upper.panel=panel.cor) }
} #end of else (smooth)
} #end of function
panel.cor.scale <- function(x, y, digits=2, prefix="", cex.cor)
{
usr <- par("usr"); on.exit(par(usr))
par(usr = c(0, 1, 0, 1))
r = (cor(x, y,use="pairwise"))
txt <- format(c(r, 0.123456789), digits=digits)[1]
txt <- paste(prefix, txt, sep="")
if(missing(cex.cor)) cex <- 0.8/strwidth(txt)
text(0.5, 0.5, txt, cex = cex * abs(r))
}
panel.cor <- function(x, y, digits=2, prefix="", cex.cor)
{
usr <- par("usr"); on.exit(par(usr))
par(usr = c(0, 1, 0, 1))
r = (cor(x, y,use="pairwise"))
txt <- format(c(r, 0.123456789), digits=digits)[1]
txt <- paste(prefix, txt, sep="")
if(missing(cex.cor)) cex <- 0.8/strwidth(txt)
text(0.5, 0.5, txt, cex = cex )
}
panel.hist <- function(x, ...)
{
usr <- par("usr"); on.exit(par(usr))
par(usr = c(usr[1:2], 0, 1.5) )
h <- hist(x, plot = FALSE)
breaks <- h$breaks; nB <- length(breaks)
y <- h$counts; y <- y/max(y)
rect(breaks[-nB], 0, breaks[-1], y, col="cyan", ...)
}
pairs.panels <- function (x,y,smooth=TRUE,scale=FALSE)
{if (smooth ){
if (scale) {
pairs(x,diag.panel=panel.hist,upper.panel=panel.cor.scale,lower.panel=panel.smooth)
}
else {pairs(x,diag.panel=panel.hist,upper.panel=panel.cor,lower.panel=panel.smooth)
} #else {pairs(x,diag.panel=panel.hist,upper.panel=panel.cor,lower.panel=panel.smooth)
}
else #smooth is not true
{ if (scale) {pairs(x,diag.panel=panel.hist,upper.panel=panel.cor.scale)
} else {pairs(x,diag.panel=panel.hist,upper.panel=panel.cor) }
} #end of else (smooth)
} #end of function
Data = read.csv("hpi.csv", header=TRUE, sep= ";",dec=",")
panel.cor.scale(Data$HousePriceIndex,Data$LeaseIndex)
pairs?
?pairs
?pairs
panel.cor.scale(Data$HousePriceIndex,Data$LeaseIndex, upper.panel = panel.cor,lower)
pairs(Data$HousePriceIndex,Data$LeaseIndex, upper.panel = panel.cor,lower.panel = pairs.panels, diag.panel = panel.hist)
pairs(Data, upper.panel = panel.cor,lower.panel = pairs.panels, diag.panel = panel.hist)
pairs(Data, upper.panel = panel.cor,lower.panel = pairs.panels, diag.panel = panel.hist)
?pairs
pairs(Data[,1:5], upper.panel = panel.cor,lower.panel = pairs.panels, diag.panel = panel.hist)
View(Data)
View(Data)
pairs(Data[,4:9], upper.panel = panel.cor,lower.panel = pairs.panels, diag.panel = panel.hist)
pairs(Data[,4:9], upper.panel = panel.cor,lower.panel = pairs.panels, diag.panel = panel.hist)
pairs(Data[,c(4:9)], upper.panel = panel.cor,lower.panel = pairs.panels, diag.panel = panel.hist)
?pairs
pairs(Data[4:9], upper.panel = panel.cor,lower.panel = pairs.panels, diag.panel = panel.hist)
pairs(Data[4:9], upper.panel = panel.cor, diag.panel = panel.hist)
?loess
pairs(Data[4:9], upper.panel = panel.cor,lower.panel = pairs.loess, diag.panel = panel.hist)
pairs(Data[4:9], upper.panel = panel.cor,lower.panel = pairs.smooth, diag.panel = panel.hist)
pairs(Data[4:9], upper.panel = panel.cor,lower.panel = panel.smooth, diag.panel = panel.hist)
pairs(Data[4:17], upper.panel = panel.cor,lower.panel = pairs.smooth, diag.panel = panel.hist)
pairs(Data[4:17], upper.panel = panel.cor,lower.panel = panel.smooth, diag.panel = panel.hist)
pairs(Data[4:10], upper.panel = panel.cor,lower.panel = panel.smooth, diag.panel = panel.hist)
pairs(Data[4:11], upper.panel = panel.cor,lower.panel = panel.smooth, diag.panel = panel.hist)
pairs(Data[c(4,12:17)], upper.panel = panel.cor,lower.panel = panel.smooth, diag.panel = panel.hist)
pairs(Data[4:11], upper.panel = panel.cor,lower.panel = panel.smooth, diag.panel = panel.hist)
pairs(Data[c(4,12:17)], upper.panel = panel.cor,lower.panel = panel.smooth, diag.panel = panel.hist)
plot((HousePriceIndex-mean(HousePriceIndex))/sd(HousePriceIndex) ~YearMonth,
xlab="Time",
ylab="Scaled indices/rates",
type="l",
main="Comparison",
col="black",
ylim=c(-2, 2.3),
lwd=4)
Data = read.csv("hpi.csv", header=TRUE, sep= ";",dec=",")
HousePrice_mdl =lm(HousePriceIndex ~LeaseIndex+
ConstructionCostIndex+
LoansOfBanksToHouseholds+
PurchasingPower+
Inflation+
HousingFinished+
IndexLoans
)
attach(Data)
HousePrice_mdl =lm(HousePriceIndex ~LeaseIndex+
ConstructionCostIndex+
LoansOfBanksToHouseholds+
PurchasingPower+
Inflation+
HousingFinished+
IndexLoans
)
summary(HousePrice_mdl)
HousePrices_resid = plot(residuals(HousePrice_mdl), type= 'l')
# see that New housing finished variable does not make a good fit. We are not ready to dump this variable yet.
# Because we think it brings information to the system.
pairs(Data[4:11], upper.panel = panel.cor,lower.panel = panel.smooth, diag.panel = panel.hist)
pairs(Data[c(4,12:17)], upper.panel = panel.cor,lower.panel = panel.smooth, diag.panel = panel.hist)
#We can see from this pair plot that house price index is higly correlated with housing finished!
#Plot the relationship between house prices and leasing over time. Theorize on the relationship
# between the two variables. Is there an endogenous relationship between the two?
plot((HousePriceIndex-mean(HousePriceIndex))/sd(HousePriceIndex) ~YearMonth,
type="l",
main="Comparison",
xlab="Time",
ylab="House Price Index/Lease Index",
ylim=c(-2, 2),
col="black")
lines((LeaseIndex-mean(LeaseIndex))/sd(LeaseIndex) ~YearMonth,
type="l",
main="Lease index",
col="dark red")
legend("topleft",
c("House Price index","Lease index"),
lty = 1,
col=c('black', 'darkred'),
cex=0.6)
#THEORY : There is an apparent linear relationship, but we dont see the economic crash effect with the lease index .
# We see a endogenous relationship.
# Do some preliminary analysis, plotting all variables with the house price index.
pairs(Data[4:11], upper.panel = panel.cor,lower.panel = panel.smooth, diag.panel = panel.hist)
pairs(Data[c(4,12:17)], upper.panel = panel.cor,lower.panel = panel.smooth, diag.panel = panel.hist)
# Plot House Price index vs. Construction Cost, Real estate Transactions, Loans of Banks to Households
layout(1:1)
plot((HousePriceIndex-mean(HousePriceIndex))/sd(HousePriceIndex) ~YearMonth,
xlab="Time",
ylab="Scaled indices/rates",
type="l",
main="Comparison",
col="black",
ylim=c(-2, 2.3),
lwd=4)
lines((ConstructionCostIndex-mean(ConstructionCostIndex))/sd(ConstructionCostIndex) ~YearMonth,
type="l",
col="dark red")
lines((RealEstateTransactions-mean(RealEstateTransactions))/sd(RealEstateTransactions) ~YearMonth,
type="l",
col="green",
)
lines((LoansOfBanksToHouseholds-mean(LoansOfBanksToHouseholds))/sd(LoansOfBanksToHouseholds) ~YearMonth,
type = 'l',
col="purple"
)
legend("topleft",
c("House Price index","Construction Cost index","Real Estate Transactions", "Loans of Banks to Housholds"),
lty = 1,
col=c('black', 'darkred','green','purple'),
cex=0.6,
lwd=4)
#Loans of Banks to households seem to share similar trend.
# Plot House Price index vs. UnindexedLoans, CentralBankRates, Inflation
layout(1:1)
plot((HousePriceIndex-mean(HousePriceIndex))/sd(HousePriceIndex) ~YearMonth,
xlab="Time",
ylab="Scaled indexes/rates",
type="l",
main="Comparison",
col="black",
ylim=c(-1.6, 3.2),
lwd=4)
lines((Un.indexedLoans-mean(Un.indexedLoans))/sd(Un.indexedLoans) ~YearMonth,
type="l",
col="dark red")
lines((CentralBankRates-mean(CentralBankRates))/sd(CentralBankRates) ~YearMonth,
type="l",
col="green")
lines((Inflation-mean(Inflation))/sd(Inflation) ~YearMonth,
type = 'l',
col="purple"
)
legend("topleft",
c("House Price index","Unindexed Loans","Central Bank Rates", "Inflation"),
lty = 1,
col=c('black', 'darkred','green','purple'),
cex=0.6,
lwd=4)
#Central Bank Rates seem to share a similar trend.
# Plot House Price index vs. PurchasingPower, PurchasingPowerOfWages, IndexLoans
layout(1:1)
plot((HousePriceIndex-mean(HousePriceIndex))/sd(HousePriceIndex) ~YearMonth,
xlab="Time",
ylab="Scaled indexes/rates",
type="l",
main="Comparison",
col="black",
ylim=c(-3, 2.5),
lwd=4)
lines((PurchasingPower-mean(PurchasingPower))/sd(PurchasingPower) ~YearMonth,
type="l",
col="dark red")
lines((PurchasingPowerOfWages-mean(PurchasingPowerOfWages))/sd(PurchasingPowerOfWages) ~YearMonth,
type="l",
col="green")
lines((IndexLoans-mean(IndexLoans))/sd(IndexLoans) ~YearMonth,
type = 'l',
)
col="purple"
legend("topleft",
c("House Price index","Purchasing Power","Purchasing Power of Wages", "Index Loans"),
lty = 1,
col=c('black', 'darkred','green','purple'),
cex=0.6,
lwd=4)
#Purchasing power of wages and index loans, seem to share a similar trend
# Plot House Price index vs. CurrencyLoans, HousingStarts, HousingFinished
layout(1:1)
plot((HousePriceIndex-mean(HousePriceIndex))/sd(HousePriceIndex) ~YearMonth,
xlab="Time",
ylab="Scaled indexes/rates",
type="l",
main="Comparison",
col="black",
ylim=c(-1.7, 4.5),
lwd=4)
lines((CurrencyLoans-mean(CurrencyLoans))/sd(CurrencyLoans) ~YearMonth,
type="l",
col="dark red")
lines((HousingStarts-mean(HousingStarts))/sd(HousingStarts) ~YearMonth,
type="l",
col="green")
lines((HousingFinished-mean(HousingFinished))/sd(HousingFinished) ~YearMonth,
type = 'l',
col="purple"
)
legend("topleft",
c("House Price index","Currency Loans","Housing Starts", "Housing Finished"),
lty = 1,
col=c('black', 'darkred','green','purple'),
cex=0.6,
lwd=4)
#Housing finished seem to share a similar trend.
#now a comparison of variables with similar trend
plot((HousePriceIndex-mean(HousePriceIndex))/sd(HousePriceIndex) ~YearMonth,
xlab="Time",
ylab="Scaled indexes/rates",
type="l",
main="Comparison of variables with similar trend",
col="black",
ylim=c(-1.5, 2.5),
lwd=4)
lines((CentralBankRates-mean(CentralBankRates))/sd(CentralBankRates) ~YearMonth,
type="l",
col="dark red")
lines((LoansOfBanksToHouseholds-mean(LoansOfBanksToHouseholds))/sd(LoansOfBanksToHouseholds) ~YearMonth,
type="l",
col="green")
lines((HousingFinished-mean(HousingFinished))/sd(HousingFinished) ~YearMonth,
type = 'l',
col="purple"
)
?corr
cor(Un.indexedLoans,IndexLoans)
cor(HousePriceIndex,LoansOfBanksToHouseholds)
HousePrice_mdl =lm(HousePriceIndex ~LeaseIndex+
ConstructionCostIndex+
LoansOfBanksToHouseholds+
PurchasingPower+
Inflation+
HousingFinished+
IndexLoans
)
summary(HousePrice_mdl)
HousePrices_resid = plot(residuals(HousePrice_mdl), type= 'l')
# see that New housing finished variable does not make a good fit. We are not ready to dump this variable yet.
# Because we think it brings information to the system.
pairs(Data[4:11], upper.panel = panel.cor,lower.panel = panel.smooth, diag.panel = panel.hist)
pairs(Data[c(4,12:17)], upper.panel = panel.cor,lower.panel = panel.smooth, diag.panel = panel.hist)
#We can see from this pair plot that house price index is higly correlated with housing finished!
#Plot the relationship between house prices and leasing over time. Theorize on the relationship
# between the two variables. Is there an endogenous relationship between the two?
plot((HousePriceIndex-mean(HousePriceIndex))/sd(HousePriceIndex) ~YearMonth,
type="l",
main="Comparison",
xlab="Time",
ylab="House Price Index/Lease Index",
ylim=c(-2, 2),
col="black")
lines((LeaseIndex-mean(LeaseIndex))/sd(LeaseIndex) ~YearMonth,
type="l",
main="Lease index",
col="dark red")
legend("topleft",
c("House Price index","Lease index"),
lty = 1,
col=c('black', 'darkred'),
cex=0.6)
#THEORY : There is an apparent linear relationship, but we dont see the economic crash effect with the lease index .
# We see a endogenous relationship.
# Do some preliminary analysis, plotting all variables with the house price index.
pairs(Data[4:11], upper.panel = panel.cor,lower.panel = panel.smooth, diag.panel = panel.hist)
pairs(Data[c(4,12:17)], upper.panel = panel.cor,lower.panel = panel.smooth, diag.panel = panel.hist)
# Plot House Price index vs. Construction Cost, Real estate Transactions, Loans of Banks to Households
layout(1:1)
plot((HousePriceIndex-mean(HousePriceIndex))/sd(HousePriceIndex) ~YearMonth,
xlab="Time",
ylab="Scaled indices/rates",
type="l",
main="Comparison",
col="black",
ylim=c(-2, 2.3),
lwd=4)
lines((ConstructionCostIndex-mean(ConstructionCostIndex))/sd(ConstructionCostIndex) ~YearMonth,
type="l",
col="dark red")
lines((RealEstateTransactions-mean(RealEstateTransactions))/sd(RealEstateTransactions) ~YearMonth,
type="l",
col="green",
)
lines((LoansOfBanksToHouseholds-mean(LoansOfBanksToHouseholds))/sd(LoansOfBanksToHouseholds) ~YearMonth,
type = 'l',
col="purple"
)
legend("topleft",
c("House Price index","Construction Cost index","Real Estate Transactions", "Loans of Banks to Housholds"),
lty = 1,
col=c('black', 'darkred','green','purple'),
cex=0.6,
lwd=4)
#Loans of Banks to households seem to share similar trend.
# Plot House Price index vs. UnindexedLoans, CentralBankRates, Inflation
layout(1:1)
plot((HousePriceIndex-mean(HousePriceIndex))/sd(HousePriceIndex) ~YearMonth,
xlab="Time",
ylab="Scaled indexes/rates",
type="l",
main="Comparison",
col="black",
ylim=c(-1.6, 3.2),
lwd=4)
lines((Un.indexedLoans-mean(Un.indexedLoans))/sd(Un.indexedLoans) ~YearMonth,
type="l",
col="dark red")
lines((CentralBankRates-mean(CentralBankRates))/sd(CentralBankRates) ~YearMonth,
type="l",
col="green")
lines((Inflation-mean(Inflation))/sd(Inflation) ~YearMonth,
type = 'l',
col="purple"
)
legend("topleft",
c("House Price index","Unindexed Loans","Central Bank Rates", "Inflation"),
lty = 1,
col=c('black', 'darkred','green','purple'),
cex=0.6,
lwd=4)
#Central Bank Rates seem to share a similar trend.
?lag
)
)
legend("topleft",
c("House Price index","Unindexed Loans","Central Bank Rates", "Inflation"),
lty = 1,
col=c('black', 'darkred','green','purple'),
cex=0.6,
lwd=4)
#Central Bank Rates seem to share a similar trend.
# Plot House Price index vs. PurchasingPower, PurchasingPowerOfWages, IndexLoans
layout(1:1)
plot((HousePriceIndex-mean(HousePriceIndex))/sd(HousePriceIndex) ~YearMonth,
xlab="Time",
ylab="Scaled indexes/rates",
type="l",
main="Comparison",
col="black",
ylim=c(-3, 2.5),
lwd=4)
lines((PurchasingPower-mean(PurchasingPower))/sd(PurchasingPower) ~YearMonth,
type="l",
col="dark red")
lines((PurchasingPowerOfWages-mean(PurchasingPowerOfWages))/sd(PurchasingPowerOfWages) ~YearMonth,
type="l",
col="green")
lines((IndexLoans-mean(IndexLoans))/sd(IndexLoans) ~YearMonth,
type = 'l',
col="purple"
)
legend("topleft",
c("House Price index","Purchasing Power","Purchasing Power of Wages", "Index Loans"),
lty = 1,
col=c('black', 'darkred','green','purple'),
cex=0.6,
lwd=4)
#Purchasing power of wages and index loans, seem to share a similar trend
# Plot House Price index vs. CurrencyLoans, HousingStarts, HousingFinished
layout(1:1)
plot((HousePriceIndex-mean(HousePriceIndex))/sd(HousePriceIndex) ~YearMonth,
xlab="Time",
ylab="Scaled indexes/rates",
type="l",
main="Comparison",
col="black",
ylim=c(-1.7, 4.5),
lwd=4)
lines((CurrencyLoans-mean(CurrencyLoans))/sd(CurrencyLoans) ~YearMonth,
type="l",
col="dark red")
lines((HousingStarts-mean(HousingStarts))/sd(HousingStarts) ~YearMonth,
type="l",
col="green")
lines((HousingFinished-mean(HousingFinished))/sd(HousingFinished) ~YearMonth,
type = 'l',
col="purple"
)
legend("topleft",
c("House Price index","Currency Loans","Housing Starts", "Housing Finished"),
lty = 1,
col=c('black', 'darkred','green','purple'),
cex=0.6,
lwd=4)
#Housing finished seem to share a similar trend.
#now a comparison of variables with similar trend
plot((HousePriceIndex-mean(HousePriceIndex))/sd(HousePriceIndex) ~YearMonth,
xlab="Time",
ylab="Scaled indexes/rates",
type="l",
main="Comparison of variables with similar trend",
col="black",
ylim=c(-1.5, 2.5),
lwd=4)
lines((CentralBankRates-mean(CentralBankRates))/sd(CentralBankRates) ~YearMonth,
type="l",
col="dark red")
lines((LoansOfBanksToHouseholds-mean(LoansOfBanksToHouseholds))/sd(LoansOfBanksToHouseholds) ~YearMonth,
type="l",
col="green")
lines((HousingFinished-mean(HousingFinished))/sd(HousingFinished) ~YearMonth,
type = 'l',
col="purple"
)
lines((ConstructionCostIndex-mean(ConstructionCostIndex))/sd(ConstructionCostIndex) ~YearMonth,
type = 'l',
col="blue"
)
legend("topleft",
c("House Price index","Central bank rates","loans to households", "New housing finished","Construnction cost index"),
lty = 1,
col=c('black', 'darkred','green','purple','Blue'),
cex=0.6,
lwd=4)
#-----Task 3----------
#Create a model for the house price index using all relevant variables.
HousePrices_resid = plot(residuals(HousePrice_mdl))
#New intervention model for 90% loans in the economy
Loans90 = rep(0,times=54) #initialize zeros up to 1 july 2004
#1 juli 2004 - 1okt 2008
n = 55:106
hamming_window = 0.54 - 0.46*cos((2*pi*n/(55-1)))
Loans90 = c(Loans90, hamming_window, rep(0,times=length(Month)-106))
plot(Loans90 ~YearMonth, type='l', main="90% morgage model")
#NEw model with intervention model
HousePrice_mdl =lm(HousePriceIndex
~ConstructionCostIndex+
LoansOfBanksToHouseholds+
HousingFinished+
IndexLoans+
Loans90
)
summary(HousePrice_mdl)
#PLOT HPI on fitted model
plot(HousePriceIndex ~YearMonth, type='l', col="blue",lwd=4)
lines(HousePrice_mdl$fit, type='l', col="red",lwd=4)
legend("topleft",
c("House Price index", "model fit"),
lty = 1,
col=c('black', 'red'),
cex=0.6,
lwd=4)
#----------END OF Housing economics ------------------------
#----------   Sales modeling   ---------------------------------
detach(Data)
# ------ Task 1 -------
# Y ~ beta0 + beta1*Mean.temperature(Oslo) - beta2*Total.precipitation(Oslo) + beta3*Mean.temperature(Bergen) - beta4*Total.precipitation(Bergen)
#    beta5*Print + beta6*InStore + beta7*DirectMarketing + beta8*RADIO + beta9*TV:Taktisk + beta10*TV.Image - beta11*Competitor.spending
# We don't want to use all of the data, for example we think that the sun hours in Oslo are not a significant variable, we think that total
# precipitaion is way more effective since this is a Building supply store and people are not buying and working as much when it rains/snows,
